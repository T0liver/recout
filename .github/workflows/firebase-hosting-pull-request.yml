name: Deploy to Firebase Hosting
on:
  pull_request:
    branches:
      - release

#permissions:
#  checks: write
#  contents: read
#  pull-requests: write

jobs:
  build_web:
    name: Build Flutter (Web)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: subosito/flutter-action@v1
        with:
          channel: 'stable'
          flutter-version: 3.32.0
      - run: flutter pub get
      - run: flutter config --enable-web
      - run: flutter build web
      - name: Archive Production Artifact
        uses: actions/upload-artifact@master
        with:
          name: web-build
          path: build/web

  deploy_web:
    name: Deploy Web to Firebase Hosting
    needs: build_web
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@master
      - name: Download Artifact
        uses: actions/download-artifact@master
        with:
          name: web-build
          path: web-build
      - name: Deploy to Firebase
        uses: w9jds/firebase-action@master
        with:
          args: deploy --only hosting --public web-build
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_RECOUT_13B03 }}
          PROJECT_ID: recout-13b03

  #build_and_preview:
  #  if: ${{ github.event.pull_request.head.repo.full_name == github.repository }}
  #  runs-on: ubuntu-latest
  #  steps:
  #    - uses: actions/checkout@v4
  #    - run: npm ci && npm run build
  #    - uses: FirebaseExtended/action-hosting-deploy@v0
  #      with:
  #        repoToken: ${{ secrets.GITHUB_TOKEN }}
  #        firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_RECOUT_13B03 }}
  #        projectId: recout-13b03
